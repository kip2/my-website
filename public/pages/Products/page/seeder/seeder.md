![seeder](/pages/Products/page/seeder/img/seeder.jpg)  

:::LittleBlank  

---    

使用言語：Rust    
作成日 : 2024/07/28    
作成期間：49日(うち、実作業時間は12時間)    
総コミット数：69コミット    
Github : [GitHub - seeder](https://github.com/kip2/seeder)    

---    

## 概要    

Rust製の、seederアプリ。  
seederとは、LaravelにおけるDB初期化機能の一つで、DBに初期データを追加する機能を指す、らしい(Laravel知らないので、よく知らない)。    

PostgreSQLに対応している。    

### 使い方  

使い方は以下のような手順  

- .envファイルにDBへの接続情報を記載する。    
- `seeder -c`コマンドを使用し、投入データ設定用のJSONファイルを作成する。  
- `seeder -f`コマンドを使用し、JSONファイルに定義したデータをテーブルに追加する。  

### ランダムデータの投入も可能  

なお、ランダムデータの追加も可能となっている。  

- .envファイルにDBへの接続情報を記載する。    
- `seeder -c`コマンドを使用し、カラムデータ設定用のJSONファイルを作成する。  
- `seeder -r`コマンドを使用して、ランダムに生成したデータをテーブルに追加する。  

### ヘルプ  

コマンドの使い方に迷ったとき用に、ヘルプも参照可能となっている。  

```sh  
seeder -h  
```  

:::Blank  

---  

## このツールについて  

[RecursionCS](https://recursionist.io)のバックエンドプロジェクトにおいて必要となったために作成したツール。  

要件把握と設計をどうするかという部分で悩みに悩んだ末にできた、難産の賜物。  

### なぜ時間がかかったか  

端的にいうとスランプである。  

:::LittleBlank

RecursionCSにはバックエンドプロジェクトという、バックエンドエンジニアを育てるためのカリキュラムがある。  
そのカリキュラムはphpを推奨言語としているが、その他の言語でも実装して良いという方針だったため「Rustでやってみよう」と考えて、バックエンドプロジェクトに取り掛かった。  

:::LittleBlank

そして、それが間違いの始まりであった  

:::LittleBlank

元々、このseederツールについては、サンプルとして用意されているコードが存在し、それを使ってseederの原理とDB操作を学ぶという趣旨となっている。  
このサンプルコードを使ってseederについて学び、そして実際に使用していく、という流れである(後々拡張の必要はあるけれど)。  

:::LittleBlank

さて、自分がRustで進めるにあたってはそのコードがない（当たり前だ）。  
ゆえにサンプルコードを自力で実装する必要が発生。  

:::LittleBlank

つまりは、次のような作業である。  

- phpで書かれたseederのコードがどのようなものかを把握する  
- Rustでその要件を満たすようにコードを書く  

:::LittleBlank

これだけ見るとなんでもないことのようだが、結構これが大きな壁となった。  
理由として、以下のようなものが挙げられると思う  

- Rustとphpでプログラミングのパラダイムが違っており、単純移植はできない。そのため、パラダイムの違いを吸収して要件を満たすようにコードを構築する必要がある。  
- 元のサンプルコードはphpのスクリプト言語の強みを最大限活かしたコードになっている。コンパイル型であるRustでそこの課題を解決しなくてはいけない。  
- そもそも自分の頭が良くない(はい)。  

:::LittleBlank

というわけで、その違いをどう実装するということをうんうん一ヶ月半近く悩み続け、ようやく完成したのがこのアプリ、というわけ。  

:::LittleBlank

...とはいえRustで作るのは本懐なので、この苦しみもある意味想定内である(想定してなかったけど)。  
みんなもやってみようね！別言語実装！(お目目ぐるぐる)  

### なぜPostgreSQLのみの対応か？  

バックエンドプロジェクトのためのツールの一つとして作ったと述べたが、本来、バックエンドプロジェクトの中ではMySQLを使っている。  
なぜMySQLではなく、PostgreSQLを選択したのか。  

:::LittleBlank

本来、このプロジェクトでは動的なwebサービスをデプロイするという趣旨になっているため、デプロイ先としてAWSなどを借りる必要があり、お金がどうしてもかかってくる(自分がお金のかからないやり方を知らないだけかもだけど)。  

:::LittleBlank

あまりお金をかけたくない。  
できれば無料でデプロイできるサービスを使いたい。  

:::LittleBlank

しかし、デプロイサービスを調べたところ、静的サイトのデプロイで無料のところはいくらも見つかるが、動的サイトのデプロイで無料のところがなかなか見つからない。  
(探し方が悪いかもしれない。もし、動的サイトを無料でデプロイできるようなサービスを知っている人いたら教えてください)  

:::LittleBlank

そして、DBだけでもなんとかならないかと考えていたところ、ServerlessDBというものを発見。  

:::LittleBlank

さて、このServerlessDB、無料で使えるところではPostgreSQLをサポートしているサービスが多いことが判明。  
なので、PostgreSQLのみに舵を切った。  
そして、舵を切ったため、ツールもPostgreSQLに対応する必要が発生。  

:::LittleBlank

これまでのツールはどちらでも使えるように作ってきたので大丈夫。  
今回のseederアプリにおいてはMySQLへの対応をパージした、ということである。  

### 拡張しないのか？  

今回使用しているsqlx crateは、複数のDBでの実装も作りやすいものとなっているため、拡張自体は可能。  

:::LittleBlank

また、今まで作った[アプリ](https://kip2.dev/products/migrate)でも、MySQLとPostgreSQLの両対応していた。  

:::LittleBlank

しかし、今回は上記のスランプもあり、YAGNIの法則を我田引水した結果、積極的には拡張しない方針に決定。  

:::LittleBlank

とはいえ、拡張自体は興味深いし、ツールとしての利用範囲も広がるので、余裕が出れば対応予定である。  
そのうち、そのうちな......  
