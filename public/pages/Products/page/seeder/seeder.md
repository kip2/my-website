![seeder](/pages/Products/page/seeder/img/seeder.jpg)  

:::LittleBlank  

---    

使用言語：Rust    
作成日 : 2024/07/28    
作成期間：49日(うち、実作業時間は12時間)    
総コミット数：69コミット    
Github : [GitHub - seeder](https://github.com/kip2/seeder)    

---    

## 概要    

Rust製のseederアプリ。  
seederとは、LaravelにおけるDB初期化機能の一つで、DBに初期データを追加する機能を指す、らしい(Laravel知らないので、よく知らない)。    

:::LittleBlank

PostgreSQLに対応。    

### 使い方  

使い方は以下のような手順  

- .envファイルにDBへの接続情報を記載する。    
- `seeder -c`コマンドを使用し、投入データ設定用のJSONファイルを作成する。  
- `seeder -f`コマンドを使用し、JSONファイルに定義したデータをテーブルに追加する。  

### ランダムデータの投入も可能  

なお、ランダムデータの追加も可能となっている。  

- .envファイルにDBへの接続情報を記載する。    
- `seeder -c`コマンドを使用し、カラムデータ設定用のJSONファイルを作成する。  
- `seeder -r`コマンドを使用して、ランダムに生成したデータをテーブルに追加する。  

### ヘルプ  

コマンドの使い方に迷ったとき用に、ヘルプも参照可能となっている。  

```sh  
seeder -h  
```  

:::Blank  

---  

## このツールについて  

[RecursionCS](https://recursionist.io)のバックエンドプロジェクトにおいて必要となったために作成したツール。  

:::LittleBlank

要件把握と設計をどうするかという部分で悩みに悩んだ末にできた、難産の賜物。  

### なぜ時間がかかったか  

端的にいうとスランプである。  

:::LittleBlank

RecursionCSにはバックエンドプロジェクトという、バックエンドエンジニアを育てるためのカリキュラムがある。  
そのカリキュラムはphpを推奨言語としているが、その他の言語でも実装して良いという方針だったため「Rustでやってみよう」と考えて、バックエンドプロジェクトに取り掛かった。  

:::Blank

そして、それが間違いの始まりであった  

:::Blank

元々、このseederツールについてはサンプルとして用意されているコードが存在し、それを使ってseederの原理とDB操作を学ぶという趣旨となっている。  
そして、このサンプルコードのseederを拡張しながら成果物作成を行なっていくのがプロジェクトの流れ。  

:::Blank

さて、自分がRustで進めるにあたってはそのコードがない（当たり前だ）。  
ゆえにサンプルコードを自力で実装する必要が発生。  

:::LittleBlank

つまりは、次のような作業である。  

- phpで書かれたseederのコードがどのようなものかを把握する  
- Rustでその要件を満たすようにコードを書く  

:::LittleBlank

これだけ見るとなんでもないことのようだが、結構これが大きな壁となった。  
理由として、以下のようなものが挙げられる。 

- Rustとphpでプログラミングのパラダイムが異なっており、単純移植ができない。そのため、パラダイムの違いを吸収した上で、要件を満たすようにコードを構築する必要がある。  
- 元のサンプルコードはphpのスクリプト言語の強みを最大限活かしたコードになっている。Rustはコンパイル型のため、そこの課題を解決しなくてはいけない。  
- そもそも自分の頭が良くない(はい)。  

:::LittleBlank

その違いをどう実装するのか、ということを、「うんうん」一ヶ月半近く悩み続け、ようやく完成したのがこのアプリ、ということ。  

:::LittleBlank

作成には主に苦しみが伴ったが、Rustで作るのは本懐なので、この苦しみもある意味想定内である(人には全く勧められないけれど)。

### なぜPostgreSQLのみの対応か？  

バックエンドプロジェクトのためのツールの一つと述べたが、本来、バックエンドプロジェクトの中ではMySQLを使っている。  
なぜMySQLではなく、PostgreSQLを選択したのか。  

:::LittleBlank

本来、このプロジェクトでは動的なwebサービスをデプロイするという趣旨になっているため、デプロイ先としてAWSなどを借りる必要があり、お金がどうしてもかかる(自分がお金のかからないやり方を知らないだけかもだけど)。  

:::LittleBlank

あまりお金をかけたくない。  
できれば無料でデプロイできるサービスを使いたい。  

:::LittleBlank

しかし、デプロイサービスを調べたところ、静的サイトのデプロイで無料のところはいくらも見つかるが、動的サイトのデプロイで無料のところがなかなか見つからない。  
(探し方が悪いかもしれない。もし、動的サイトを無料でデプロイできるようなサービスを知っている人いたら教えてください)  

:::LittleBlank

そして、DBだけでもなんとかならないかと考えていたところ、ServerlessDBというものを発見。  
このサービス、無料で使えるところでMySQLをサポートしたところは少なく、PostgreSQLをサポートしているサービスが多いことが判明。  

:::LittleBlank

なので、PostgreSQLを使おうと、決めた。  
そのように決めたため、ツールに関してもPostgreSQLに対応する必要が発生。  

:::LittleBlank

これまでのツールについては、どちらのDBでも使えるように作ってきているのでOK。  
そして、今回のseederアプリにおいてはPostgreSQLへ対応した、ということである。  

### 拡張しないのか？  

今回使用しているsqlx crateは、複数のDBでの実装も作りやすいものとなっているため、拡張自体は可能。  
また、今まで作った[アプリ](https://kip2.dev/products/migrate)でも、MySQLとPostgreSQLの両対応していた。  

:::LittleBlank

しかし、今回は上記のスランプもあり(正直疲れていたし、モチベーションがやばかった...)、YAGNIの法則を我田引水した結果、積極的には拡張しない方針に決定。  

:::LittleBlank

とはいえ、拡張自体は興味深いし、ツールとしての利用範囲も広がるので、余裕が出てくれば対応予定である。  
そのうち、そのうちな......  
